# name: CI

# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main ]

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     services:
#       postgres:
#         image: postgres:15
#         env:
#           POSTGRES_PASSWORD: testpass
#           POSTGRES_DB: solhealth_test
#         options: >-
#           --health-cmd pg_isready
#           --health-interval 10s
#           --health-timeout 5s
#           --health-retries 5
#         ports:
#           - 5432:5432

#     steps:
#     - uses: actions/checkout@v4

#     - name: Set up Python
#       uses: actions/setup-python@v4
#       with:
#         python-version: '3.11'

#     - name: Cache pip
#       uses: actions/cache@v3
#       with:
#         path: ~/.cache/pip
#         key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
#         restore-keys: |
#           ${{ runner.os }}-pip-

#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         pip install -r requirements.txt
#         pip install -r dev-requirements.txt

#     - name: Lint with flake8
#       run: |
#         flake8 src tests --max-line-length=88 --extend-ignore=E203,W503

#     - name: Check formatting with black
#       run: |
#         black --check src tests

#     - name: Type check with mypy
#       run: |
#         mypy src

#     - name: Test with pytest
#       env:
#         RDS_HOST: localhost
#         RDS_PORT: 5432
#         RDS_USER: postgres
#         RDS_PASSWORD: testpass
#         RDS_DATABASE: solhealth_test
#       run: |
#         pytest --cov=src --cov-report=xml

#     - name: Upload coverage
#       uses: codecov/codecov-action@v3
#       with:
#         file: ./coverage.xml

#   docker:
#     runs-on: ubuntu-latest
#     needs: test

#     steps:
#     - uses: actions/checkout@v4

#     - name: Build Docker image
#       run: docker build -t solhealth-backend .

#     - name: Run Trivy vulnerability scanner
#       uses: aquasecurity/trivy-action@master
#       with:
#         image-ref: solhealth-backend
#         format: 'sarif'
#         output: 'trivy-results.sarif'

#     - name: Upload Trivy scan results
#       uses: github/codeql-action/upload-sarif@v2
#       with:
#         sarif_file: 'trivy-results.sarif'
